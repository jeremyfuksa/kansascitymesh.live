---
import Layout from "../Layout.astro";
import DiscordInviteCard from "../../components/DiscordInviteCard.astro";

const { entry } = Astro.props as { entry: any };
const { Content } = await entry.render();
const data = entry.data ?? {};
const {
  title = "",
  description = "",
  pageHeading,
  heroVariant,
  faqs = [],
  discordInvite,
} = data as Record<string, any>;

const accordionId = "faqAccordion";
---

<Layout
  title={title}
  description={description}
  pageHeading={pageHeading}
  heroVariant={heroVariant}
>
  <div class="d-flex flex-column gap-4">
    <article class="content-body">
      <Content />
    </article>

    {faqs.length > 0 && (
      <div class="accordion" id={accordionId}>
        {faqs.map((faq: any, index: number) => {
          const itemId = `${accordionId}-item-${index}`;
          const headerId = `${itemId}-header`;
          const paragraphs = String(faq.answer ?? "").split(/\n\s*\n/);
          return (
            <div class="accordion-item" key={`faq-${index}`}>
              <h2 class="accordion-header" id={headerId}>
                <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target={`#${itemId}`}
                  aria-expanded="false"
                  aria-controls={itemId}
                >
                  {faq.question}
                </button>
              </h2>
              <div
                id={itemId}
                class="accordion-collapse collapse"
                aria-labelledby={headerId}
                data-bs-parent={`#${accordionId}`}
              >
                <div class="accordion-body">
                  {paragraphs.map((paragraph, pIndex) => (
                    <p class="mb-2" key={`faq-${index}-p-${pIndex}`}>
                      {paragraph.trim()}
                    </p>
                  ))}
                </div>
              </div>
            </div>
          );
        })}
      </div>
    )}

    {discordInvite && (
      <DiscordInviteCard
        title={discordInvite.title}
        description={discordInvite.description}
        link={discordInvite.link}
        linkText={discordInvite.linkText}
      />
    )}
  </div>
</Layout>
