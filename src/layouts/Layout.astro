---
import "../styles/global.css";
import CampfireFooter from "../components/campfire/CampfireFooter.astro";

interface Props {
  title?: string;
  description?: string;
  pageHeading?: string;
  heroVariant?: "default" | "compact";
}

const {
  title = "Kansas City Meshtastic Network",
  description = "Community-built Meshtastic mesh network for the Kansas City metro.",
  pageHeading,
  heroVariant = "default",
} = Astro.props as Props;

const currentPath = Astro.url.pathname.replace(/\/$/, "") || "/";
const resolvedTitle = currentPath === "/" ? title : `${title} | KC Meshtastic`;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <meta name="generator" content={Astro.generator} />
    <script is:inline>
      {`(function(){try{const storageKey='kcmesh-theme';const root=document.documentElement;const stored=localStorage.getItem(storageKey);const prefersDark=window.matchMedia('(prefers-color-scheme: dark)').matches;const theme=stored|| (prefersDark?'dark':'light');if(theme==='dark'){root.classList.add('dark');}else{root.classList.remove('dark');}root.dataset.theme=theme;}catch(e){}})();`}
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PJQ97M0QBT"></script>
    <script is:inline>
      {`window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-PJQ97M0QBT');`}
    </script>
    
    <!-- Privacy-friendly analytics by Plausible -->
    <script async src="https://plausible.io/js/pa-5gAk7DpnMbYh336dPlicj.js"></script>
    <script>
      window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
      plausible.init()
    </script>

    <title>{resolvedTitle}</title>
    <meta name="description" content={description} />
    <script
      src="https://kit.fontawesome.com/02023a5bb5.js"
      crossorigin="anonymous"
      async>
    </script>
  </head>
  <body class="min-h-screen bg-background text-foreground">
    <a class="skip-link" href="#main-content">Skip to main content</a>

    <main id="main-content" class="flex-1">
      {pageHeading && (
        <section class="max-w-[1320px] mx-auto px-6 mb-10">
          <p class="uppercase tracking-[0.3em] text-[12px] font-semibold text-neutral-500 dark:text-neutral-400 mb-4">
            Kansas City Meshtastic
          </p>
          <h1 class={`text-[36px] lg:text-[56px] font-bold text-neutral-900 dark:text-neutral-50 leading-tight ${heroVariant === 'compact' ? 'mb-4' : 'mb-6'}`}>
            {pageHeading}
          </h1>
          {description && (
            <p class="text-[18px] lg:text-[20px] text-neutral-600 dark:text-neutral-400 max-w-[80ch]">
              {description}
            </p>
          )}
        </section>
      )}
      <div class="px-6">
        <div class="max-w-[1320px] mx-auto">
          <slot />
        </div>
      </div>
    </main>

    <CampfireFooter />

    <script is:inline>
      // Add Font Awesome external link icons after page load
      document.addEventListener('DOMContentLoaded', function() {
        const contentBody = document.querySelector('.content-body');
        if (!contentBody) return;

        const links = contentBody.querySelectorAll('a[href^="http"]:not([href*="kansascitymesh.live"]), a[target="_blank"]');

        links.forEach(link => {
          if (link.querySelector('.external-link-icon')) return;
          const icon = document.createElement('i');
          icon.className = 'fa-solid fa-arrow-up-right-from-square external-link-icon ml-1';
          icon.setAttribute('aria-hidden', 'true');
          link.appendChild(icon);
        });
      });
    </script>
  </body>
</html>
