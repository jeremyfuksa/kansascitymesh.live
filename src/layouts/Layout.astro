---
import "../styles/global.css";
import kcMeshLogo from "../assets/kc-mesh.png";
import { Image } from 'astro:assets';
import bootstrapBundleUrl from "bootstrap/dist/js/bootstrap.bundle.min.js?url";
import packageInfo from '../../package.json';

interface Props {
  title?: string;
  description?: string;
  pageHeading?: string;
  heroVariant?: "default" | "compact";
}

const {
  title = "Kansas City Meshtastic Network",
  description = "Community-built Meshtastic mesh network for the Kansas City metro.",
  pageHeading,
  heroVariant = "default",
} = Astro.props as Props;

const navLinks = [
  { href: "/", label: "Home" },
  { href: "/about/why-meshtastic", label: "Why Meshtastic" },
  { href: "/get-started/join", label: "Get Started" },
  { href: "/network/coverage", label: "Coverage" },
  { href: "/community/contact", label: "Contact" },
] as const;

const currentPath = Astro.url.pathname.replace(/\/$/, "") || "/";
const resolvedTitle = currentPath === "/" ? title : `${title} | KC Meshtastic`;
const spacingClass = heroVariant === "compact" ? "py-4" : "py-5";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <meta name="generator" content={Astro.generator} />


    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PJQ97M0QBT"></script>
    <script is:inline>
      {`window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-PJQ97M0QBT');`}
    </script>
    
    <!-- Privacy-friendly analytics by Plausible -->
    <script async src="https://plausible.io/js/pa-5gAk7DpnMbYh336dPlicj.js"></script>
    <script>
      window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
      plausible.init()
    </script>

    <title>{resolvedTitle}</title>
    <meta name="description" content={description} />
    <script src={bootstrapBundleUrl} defer></script>
    <script
      src="https://kit.fontawesome.com/02023a5bb5.js"
      crossorigin="anonymous"
      async>
    </script>
  </head>
  <body class="d-flex flex-column min-vh-100 bg-light-subtle">

    <a class="skip-link" href="#main-content">Skip to main content</a>
    <nav class="navbar navbar-expand-md navbar-light bg-white border-bottom shadow-sm sticky-top">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center gap-2" href="/">
          <Image
            src={kcMeshLogo}
            alt="Kansas City Meshtastic Network logo"
            class="rounded-circle"
            width="40"
            height="40"
            loading="lazy"
            decoding="async"
          />
          <span class="d-none d-sm-inline fw-semibold">Kansas City Meshtastic Network</span>
          <span class="d-sm-none fw-semibold">KC Meshtastic</span>
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#primaryNav"
          aria-controls="primaryNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="primaryNav">
          <ul class="navbar-nav ms-auto align-items-md-center gap-1 gap-md-2 text-uppercase small fw-semibold">
            {
              navLinks.map((link) => {
                const normalized = link.href === "/" ? "/" : link.href;
                const isActive =
                  currentPath === normalized || currentPath.startsWith(`${normalized}/`);
                return (
                  <li class="nav-item">
                    <a
                      href={link.href}
                      class={`nav-link ${isActive ? "active text-primary" : ""}`}
                      aria-current={isActive ? "page" : undefined}
                    >
                      {link.label}
                    </a>
                  </li>
                );
              })
            }
          </ul>
        </div>
      </div>
    </nav>

    <main id="main-content" class={`flex-grow-1 ${spacingClass}`}>
      <div class="container">
        {
          pageHeading && (
            <div class="mb-4">
              <p class="section-eyebrow mb-2">Kansas City Meshtastic</p>
              <h1 class="display-5 fw-semibold mb-3">{pageHeading}</h1>
              <p class="lead text-secondary">{description}</p>
            </div>
          )
        }
        <div class="d-flex flex-column gap-4">
          <slot />
        </div>
      </div>
    </main>

    <footer class="bg-white border-top py-4 mt-auto">
      <div class="container d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3 small text-muted">
        <div>
          <div>&copy; {new Date().getFullYear()} Kansas City Meshtastic Network.</div>
          <div class="text-muted">Not affiliated with meshtastic.org or the Meshtastic Foundation.</div>
          <div class="text-muted" style="font-size: 0.75rem;">v{packageInfo.version}</div>
        </div>
        <div class="d-flex flex-wrap align-items-center gap-3">
          <a
            href="https://discord.gg/eP5VSPKU"
            class="btn btn-outline-primary d-inline-flex align-items-center gap-2"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-discord" aria-hidden="true"></i>
            Join the Discord
          </a>
          <a
            href="https://github.com/jeremyfuksa/kansascitymesh.live"
            class="link-secondary"
            target="_blank"
            rel="noopener noreferrer"
          >
            GitHub repo
          </a>
        </div>
      </div>
    </footer>


  </body>
</html>
