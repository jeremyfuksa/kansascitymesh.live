---
import "../styles/global.css";
import kcMeshLogo from "../assets/kc-mesh.png";

interface Props {
  title?: string;
  description?: string;
  pageHeading?: string;
  heroVariant?: "default" | "compact";
}

const {
  title = "Kansas City Meshtastic Network",
  description = "Community-built Meshtastic mesh network for the Kansas City metro.",
  pageHeading,
  heroVariant = "default",
} = Astro.props as Props;

const navLinks = [
  { href: "/", label: "Home" },
  { href: "/about", label: "About" },
  { href: "/get-started", label: "Get Started" },
  { href: "/network", label: "Network" },
  { href: "/resources", label: "Resources" },
  { href: "/community", label: "Community" },
] as const;

const currentPath = Astro.url.pathname.replace(/\/$/, "") || "/";
const resolvedTitle = currentPath === "/" ? title : `${title} | KC Meshtastic`;
const spacingClass = heroVariant === "compact" ? "py-4" : "py-5";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <meta name="generator" content={Astro.generator} />
    <title>{resolvedTitle}</title>
    <meta name="description" content={description} />
    <script
      src="https://kit.fontawesome.com/02023a5bb5.js"
      crossorigin="anonymous"
      async>
    </script>
  </head>
  <body class="d-flex flex-column min-vh-100 bg-light-subtle">
    <nav class="navbar navbar-expand-md navbar-light bg-white border-bottom shadow-sm sticky-top">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center gap-2" href="/">
          <img
            src={kcMeshLogo.src}
            alt="Kansas City Meshtastic Network logo"
            class="rounded-circle"
            width="40"
            height="40"
            loading="lazy"
            decoding="async"
          />
          <span class="d-none d-sm-inline fw-semibold">Kansas City Meshtastic Network</span>
          <span class="d-sm-none fw-semibold">KC Meshtastic</span>
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#primaryNav"
          aria-controls="primaryNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="primaryNav">
          <ul class="navbar-nav ms-auto align-items-md-center gap-1 gap-md-2 text-uppercase small fw-semibold">
            {
              navLinks.map((link) => {
                const normalized = link.href === "/" ? "/" : link.href;
                const isActive =
                  currentPath === normalized || currentPath.startsWith(`${normalized}/`);
                return (
                  <li class="nav-item">
                    <a
                      href={link.href}
                      class={`nav-link ${isActive ? "active text-primary" : ""}`}
                      aria-current={isActive ? "page" : undefined}
                    >
                      {link.label}
                    </a>
                  </li>
                );
              })
            }
          </ul>
        </div>
      </div>
    </nav>

    <main class={`flex-grow-1 ${spacingClass}`}>
      <div class="container">
        {
          pageHeading && (
            <div class="mb-4">
              <p class="section-eyebrow mb-2">Kansas City Meshtastic</p>
              <h1 class="display-5 fw-semibold mb-3">{pageHeading}</h1>
              <p class="lead text-secondary">{description}</p>
            </div>
          )
        }
        <div class="d-flex flex-column gap-4">
          <slot />
        </div>
      </div>
    </main>

    <footer class="bg-white border-top py-4 mt-auto">
      <div class="container d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3 small text-muted">
        <div>
          <div>&copy; {new Date().getFullYear()} Kansas City Meshtastic Network.</div>
          <div class="text-muted">Not affiliated with meshtastic.org or the Meshtastic Foundation.</div>
        </div>
        <div class="d-flex flex-wrap align-items-center gap-3">
          <a href="mailto:contact@kansascitymesh.live" class="link-secondary">contact@kansascitymesh.live</a>
          <a
            href="https://discord.gg/eP5VSPKU"
            class="btn btn-outline-primary btn-sm d-inline-flex align-items-center gap-2"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-discord" aria-hidden="true"></i>
            Join the Discord
          </a>
          <span class="text-secondary">Live status updates coming soon.</span>
        </div>
      </div>
    </footer>

    <script
      defer
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
