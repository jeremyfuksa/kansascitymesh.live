---
import Layout from '../../layouts/Layout.astro';
---

<Layout
  pageHeading="Router vs Gateway"
  description="The difference between router and gateway roles confused me at first. Here's what I figured out and when to use each."
  heroVariant="compact"
>
  <!-- Intro -->
  <section class="prose prose-lg dark:prose-invert max-w-none">
    <h2 class="text-4xl font-semibold leading-tight text-ink-900 dark:text-cream-50">
      Router vs Gateway: what's the difference?
    </h2>
    <p class="text-xl text-ink-700 dark:text-cream-100">
      When I first started learning Meshtastic, the terminology was confusing. "Router" and "Gateway" sound like they should do similar things, but they have very different roles in the network.
    </p>
    <p class="text-xl text-ink-700 dark:text-cream-100">
      Most people deploying at home want ROUTER. Gateway is for specific infrastructure nodes. Here's when to use each.
    </p>
  </section>

  <!-- Quick Decision Tree -->
  <section class="mt-12 rounded-3xl border-2 border-kc-blue/30 bg-gradient-to-br from-kc-blue/5 to-kc-sky/10 p-6 sm:p-8 dark:border-kc-sky/20 dark:from-kc-blue/10">
    <h2 class="text-2xl font-semibold text-ink-900 dark:text-cream-50">Quick decision: which do you need?</h2>
    <div class="mt-6 space-y-4">
      <div class="rounded-2xl border border-mesh-green/30 bg-mesh-green/5 p-5 dark:bg-mesh-green/10">
        <div class="text-base font-semibold text-mesh-green">You want ROUTER if:</div>
        <ul class="mt-3 space-y-2 text-sm text-ink-700 dark:text-cream-100">
          <li>• You're deploying at home (residential or repeater site)</li>
          <li>• You want to provide backbone infrastructure</li>
          <li>• You're setting up a permanent outdoor node on solar</li>
          <li>• You don't need internet connectivity for the mesh</li>
        </ul>
        <div class="mt-3 text-xs text-ink-600 dark:text-cream-200">This is what Router 1 and Router 2-4 use. Standard backbone deployment.</div>
      </div>

      <div class="rounded-2xl border border-prairie-gold/30 bg-prairie-gold/5 p-5 dark:bg-prairie-gold/10">
        <div class="text-base font-semibold text-prairie-gold">You want ROUTER_CLIENT if:</div>
        <ul class="mt-3 space-y-2 text-sm text-ink-700 dark:text-cream-100">
          <li>• You're setting up a mobile node (vehicle, backpack)</li>
          <li>• You want to use the mesh but also help route for others</li>
          <li>• You have decent elevation but move around occasionally</li>
        </ul>
        <div class="mt-3 text-xs text-ink-600 dark:text-cream-200">Hybrid mode. Routes when stationary, acts as client when mobile.</div>
      </div>

      <div class="rounded-2xl border border-kc-red/30 bg-kc-red/5 p-5 dark:bg-kc-red/10">
        <div class="text-base font-semibold text-kc-red dark:text-sunset-amber">You want CLIENT if:</div>
        <ul class="mt-3 space-y-2 text-ink-700 dark:text-cream-100">
          <li>• You're just using the mesh for personal messages</li>
          <li>• Your device moves frequently (handheld, vehicle)</li>
          <li>• You don't have permanent elevation or power</li>
        </ul>
        <div class="mt-3 text-xs text-ink-600 dark:text-cream-200">Default mode for most users. Just send/receive, don't route for others.</div>
      </div>
    </div>
  </section>

  <!-- What Router Actually Does -->
  <section class="mt-12">
    <h2 class="text-2xl font-semibold text-ink-900 dark:text-cream-50">What ROUTER mode actually does</h2>
    <div class="mt-6 prose prose-lg dark:prose-invert max-w-none">
      <p>
        <strong>A router is infrastructure.</strong> It stays in one place, relays messages for everyone, and helps extend network coverage.
      </p>
      <p>
        Router 1 (my east side node) runs 24/7 on solar, relaying messages between client nodes. It doesn't send its own messages often—it exists to provide coverage and routing for others.
      </p>
    </div>

    <div class="mt-6 grid gap-6 md:grid-cols-2">
      <div class="rounded-3xl border border-border-light bg-surface-200 p-6 dark:border-border-dark dark:bg-sand-800">
        <h3 class="text-lg font-semibold text-kc-blue dark:text-kc-sky">Router characteristics</h3>
        <ul class="mt-4 space-y-2 text-sm text-ink-700 dark:text-cream-100">
          <li>• Always on, permanent location</li>
          <li>• Relays messages for all nodes in range</li>
          <li>• Higher power budget (needs reliable solar/power)</li>
          <li>• Optimized for coverage, not battery life</li>
          <li>• Typically deployed at elevated locations</li>
        </ul>
      </div>

      <div class="rounded-3xl border border-border-light bg-surface-200 p-6 dark:border-border-dark dark:bg-sand-800">
        <h3 class="text-lg font-semibold text-kc-blue dark:text-kc-sky">Typical router deployment</h3>
        <ul class="mt-4 space-y-2 text-sm text-ink-700 dark:text-cream-100">
          <li>• Residential rooftop or flagpole</li>
          <li>• Repeater tower site</li>
          <li>• Tall building rooftop</li>
          <li>• Hilltop or elevated terrain</li>
          <li>• Any permanent high location</li>
        </ul>
      </div>
    </div>

    <div class="mt-6 rounded-xl bg-mesh-green/10 border border-mesh-green/30 p-5">
      <p class="text-sm text-ink-700 dark:text-cream-100">
        <strong>Router 1 config:</strong> ROUTER mode, LongFast preset, SF11, 100mW TX power, permanent solar installation at 15 feet elevation. Runs 24/7 providing east side coverage.
      </p>
    </div>
  </section>

  <!-- What Gateway Does -->
  <section class="mt-12">
    <h2 class="text-2xl font-semibold text-ink-900 dark:text-cream-50">What MQTT_CLIENT (Gateway) actually does</h2>
    <div class="mt-6 prose prose-lg dark:prose-invert max-w-none">
      <p>
        <strong>A gateway bridges the mesh to the internet.</strong> It connects the radio mesh to MQTT servers, allowing messages to hop between distant mesh networks or integrate with apps/services.
      </p>
      <p>
        Router 1 also runs as an MQTT gateway, connecting our KC mesh to the wider Meshtastic network via internet. Most people don't need this.
      </p>
    </div>

    <div class="mt-6 grid gap-6 md:grid-cols-2">
      <div class="rounded-3xl border border-border-light bg-surface-200 p-6 dark:border-border-dark dark:bg-sand-800">
        <h3 class="text-lg font-semibold text-kc-blue dark:text-kc-sky">Gateway characteristics</h3>
        <ul class="mt-4 space-y-2 text-sm text-ink-700 dark:text-cream-100">
          <li>• Requires internet connection (WiFi or Ethernet)</li>
          <li>• Bridges mesh to MQTT servers</li>
          <li>• Enables remote mesh visibility/monitoring</li>
          <li>• Connects separated mesh islands</li>
          <li>• Usually deployed alongside router role</li>
        </ul>
      </div>

      <div class="rounded-3xl border border-border-light bg-surface-200 p-6 dark:border-border-dark dark:bg-sand-800">
        <h3 class="text-lg font-semibold text-kc-blue dark:text-kc-sky">When you'd deploy a gateway</h3>
        <ul class="mt-4 space-y-2 text-sm text-ink-700 dark:text-cream-100">
          <li>• You have a backbone router with internet access</li>
          <li>• You want to monitor mesh from web dashboard</li>
          <li>• You want to connect to national Meshtastic network</li>
          <li>• You're testing and want remote debugging</li>
        </ul>
      </div>
    </div>

    <div class="mt-6 rounded-xl bg-kc-red/10 border border-kc-red/30 p-5 dark:bg-sunset-amber/10 dark:border-sunset-amber/30">
      <p class="text-sm text-ink-700 dark:text-cream-100">
        <strong>Security note:</strong> MQTT gateways expose your mesh to the internet. Use encryption keys. Don't run a public gateway unless you understand the implications. Router 1 runs encrypted MQTT with access controls.
      </p>
    </div>
  </section>

  <!-- Configuration Details -->
  <section class="mt-12">
    <h2 class="text-2xl font-semibold text-ink-900 dark:text-cream-50">How to configure each role</h2>
    <div class="mt-6 prose prose-lg dark:prose-invert max-w-none">
      <p>
        Configuration happens in the Meshtastic app or web interface. Here's what I set for Router 1 and what I recommend for most deployments.
      </p>
    </div>

    <div class="mt-6 space-y-6">
      <article class="rounded-3xl border border-border-light bg-surface-100 p-6 dark:border-border-dark dark:bg-sand-900">
        <h3 class="text-lg font-semibold text-ink-900 dark:text-cream-50">Router Configuration</h3>
        <div class="mt-4 space-y-3 text-sm text-ink-700 dark:text-cream-100">
          <p><strong>Device Role:</strong> ROUTER</p>
          <p><strong>Preset:</strong> LongFast (SF11, good range/speed balance for KC)</p>
          <p><strong>Region:</strong> US (915 MHz)</p>
          <p><strong>TX Power:</strong> 20-30 dBm (100-1000 mW) depending on antenna and location</p>
          <p><strong>Hop Limit:</strong> 3 (default, allows multi-hop routing)</p>
          <p><strong>Position Broadcast:</strong> Enabled with fixed location</p>
          <p><strong>WiFi/BT:</strong> Bluetooth on for local config, WiFi off unless needed</p>
        </div>
      </article>

      <article class="rounded-3xl border border-border-light bg-surface-100 p-6 dark:border-border-dark dark:bg-sand-900">
        <h3 class="text-lg font-semibold text-ink-900 dark:text-cream-50">Client Configuration</h3>
        <div class="mt-4 space-y-3 text-sm text-ink-700 dark:text-cream-100">
          <p><strong>Device Role:</strong> CLIENT</p>
          <p><strong>Preset:</strong> LongFast (same as routers for compatibility)</p>
          <p><strong>Region:</strong> US (915 MHz)</p>
          <p><strong>TX Power:</strong> 10-20 dBm (lower power, battery conservation)</p>
          <p><strong>Position Broadcast:</strong> Enabled with GPS or manual location</p>
          <p><strong>Smart Position:</strong> Enabled (only broadcasts when moving)</p>
          <p><strong>Screen timeout:</strong> Short (save battery on handhelds)</p>
        </div>
      </article>

      <article class="rounded-3xl border border-border-light bg-surface-100 p-6 dark:border-border-dark dark:bg-sand-900">
        <h3 class="text-lg font-semibold text-ink-900 dark:text-cream-50">MQTT Gateway Addition (Advanced)</h3>
        <div class="mt-4 space-y-3 text-sm text-ink-700 dark:text-cream-100">
          <p><strong>Base role:</strong> Start with ROUTER (gateway is an addition)</p>
          <p><strong>MQTT Enabled:</strong> Yes</p>
          <p><strong>Server:</strong> mqtt.meshtastic.org or private server</p>
          <p><strong>Encryption:</strong> Enabled with secure key</p>
          <p><strong>Uplink/Downlink:</strong> Both enabled (bridges mesh ↔ internet)</p>
          <p><strong>WiFi required:</strong> Must configure WiFi credentials</p>
          <p class="text-xs text-ink-600 dark:text-cream-200">Only configure this if you know why you need it. Most routers don't need MQTT.</p>
        </div>
      </article>
    </div>
  </section>

  <!-- Common Mistakes -->
  <section class="mt-12">
    <h2 class="text-2xl font-semibold text-ink-900 dark:text-cream-50">Common configuration mistakes I've seen</h2>
    <div class="mt-6 space-y-4">
      <details class="group rounded-2xl border border-border-light bg-surface-100 p-5 dark:border-border-dark dark:bg-sand-900">
        <summary class="cursor-pointer text-base font-semibold text-ink-900 dark:text-cream-50">❌ Setting mobile devices to ROUTER</summary>
        <div class="mt-3 space-y-2 text-sm text-ink-700 dark:text-cream-100">
          <p><strong>Problem:</strong> Router mode assumes stationary location. Mobile routers confuse the mesh routing tables.</p>
          <p><strong>Fix:</strong> Use CLIENT for handheld/vehicle nodes. Use ROUTER_CLIENT if you want to help route when parked but need mobility.</p>
        </div>
      </details>

      <details class="group rounded-2xl border border-border-light bg-surface-100 p-5 dark:border-border-dark dark:bg-sand-900">
        <summary class="cursor-pointer text-base font-semibold text-ink-900 dark:text-cream-50">❌ Running MQTT gateway without understanding it</summary>
        <div class="mt-3 space-y-2 text-sm text-ink-700 dark:text-cream-100">
          <p><strong>Problem:</strong> MQTT exposes your mesh to internet. Unencrypted gateways leak all local traffic to public MQTT.</p>
          <p><strong>Fix:</strong> Don't enable MQTT unless you specifically need it. If you do, use encryption and understand what you're bridging.</p>
        </div>
      </details>

      <details class="group rounded-2xl border border-border-light bg-surface-100 p-5 dark:border-border-dark dark:bg-sand-900">
        <summary class="cursor-pointer text-base font-semibold text-ink-900 dark:text-cream-50">❌ Mismatched presets between router and clients</summary>
        <div class="mt-3 space-y-2 text-sm text-ink-700 dark:text-cream-100">
          <p><strong>Problem:</strong> Router on LongSlow (SF12), client on LongFast (SF11). They won't communicate reliably.</p>
          <p><strong>Fix:</strong> KC mesh uses LongFast (SF11) for all nodes. Match your router's preset on your client devices.</p>
        </div>
      </details>

      <details class="group rounded-2xl border border-border-light bg-surface-100 p-5 dark:border-border-dark dark:bg-sand-900">
        <summary class="cursor-pointer text-base font-semibold text-ink-900 dark:text-cream-50">❌ Wrong region setting</summary>
        <div class="mt-3 space-y-2 text-sm text-ink-700 dark:text-cream-100">
          <p><strong>Problem:</strong> Device set to EU region (868 MHz) instead of US (915 MHz). Won't reach any KC nodes.</p>
          <p><strong>Fix:</strong> Always verify region is set to "US" before deployment. This is the most common new user mistake.</p>
        </div>
      </details>
    </div>
  </section>

  <!-- KC Network Standards -->
  <section class="mt-12 rounded-3xl border-2 border-kc-blue/30 bg-gradient-to-br from-kc-blue/5 to-kc-sky/10 p-6 sm:p-8 dark:border-kc-sky/20 dark:from-kc-blue/10">
    <h2 class="text-2xl font-semibold text-ink-900 dark:text-cream-50">KC Mesh network standards</h2>
    <div class="mt-6 prose prose-lg dark:prose-invert max-w-none">
      <p>
        To keep the KC mesh working well together, here's what Router 1 and future routers use:
      </p>
    </div>
    <div class="mt-6 grid gap-4 md:grid-cols-2">
      <div class="text-sm text-ink-700 dark:text-cream-100">
        <div class="font-semibold text-ink-900 dark:text-cream-50">Frequency</div>
        <div class="mt-1">915 MHz (US ISM band)</div>
      </div>
      <div class="text-sm text-ink-700 dark:text-cream-100">
        <div class="font-semibold text-ink-900 dark:text-cream-50">Preset</div>
        <div class="mt-1">LongFast (SF11, 125 kHz BW)</div>
      </div>
      <div class="text-sm text-ink-700 dark:text-cream-100">
        <div class="font-semibold text-ink-900 dark:text-cream-50">Hop Limit</div>
        <div class="mt-1">3 (default)</div>
      </div>
      <div class="text-sm text-ink-700 dark:text-cream-100">
        <div class="font-semibold text-ink-900 dark:text-cream-50">Channel</div>
        <div class="mt-1">LongFast default (public)</div>
      </div>
    </div>
    <div class="mt-6 rounded-xl bg-kc-blue/5 border border-kc-blue/20 p-5 dark:bg-kc-sky/5 dark:border-kc-sky/20">
      <p class="text-sm text-ink-700 dark:text-cream-100">
        <strong>Your nodes should match these settings</strong> to participate in the KC mesh. You can add private channels on top of this, but the primary channel should be compatible.
      </p>
    </div>
  </section>

  <!-- Next Steps -->
  <section class="mt-12 text-center">
    <div class="inline-block rounded-3xl bg-gradient-to-br from-kc-blue to-kc-red p-8 text-cream-50 shadow-card md:p-10">
      <h3 class="text-2xl font-semibold">Ready to configure your node?</h3>
      <p class="mt-3 max-w-xl text-base opacity-95">
        Most people want CLIENT for personal use or ROUTER for infrastructure deployment. Start with one, change it later if needed—configuration is flexible.
      </p>
      <div class="mt-6 flex flex-wrap justify-center gap-4">
        <a
          href="/get-started/join"
          class="inline-flex items-center justify-center rounded-full bg-cream-50 px-6 py-2.5 text-sm font-semibold uppercase tracking-wide text-kc-blue transition hover:bg-surface-200"
        >
          Setup Guide
        </a>
        <a
          href="/resources/troubleshooting"
          class="inline-flex items-center justify-center rounded-full border border-cream-50 px-6 py-2.5 text-sm font-semibold uppercase tracking-wide text-cream-50 transition hover:bg-cream-50 hover:text-kc-blue"
        >
          Troubleshooting
        </a>
      </div>
    </div>
  </section>
</Layout>
