---
/**
 * Campfire Design System Navigation Component
 * Based on mt/components/Navigation.tsx
 */
import CampfireButton from './CampfireButton.astro';
import ThemeToggle from './ThemeToggle.astro';

const navLinks = [
  { href: "/", label: "Home" },
  { href: "/about/why-meshtastic", label: "Why Meshtastic" },
  { href: "/get-started/join", label: "Get Started" },
  { href: "/network/coverage", label: "Coverage" },
  { href: "/community/contact", label: "Contact" },
];

const currentPath = Astro.url.pathname.replace(/\/$/, "") || "/";
---

<nav class="fixed top-0 left-0 right-0 bg-white/95 dark:bg-neutral-900/95 backdrop-blur-sm border-b border-neutral-200 dark:border-neutral-800 z-50">
  <div class="max-w-[1320px] mx-auto px-6">
    {/* Desktop Navigation */}
    <div class="hidden lg:flex items-center justify-between h-20">
      {/* Logo */}
      <a href="/" class="inline-flex items-center gap-3 group">
        <div class="w-10 h-10 bg-[#67ea94] rounded-[10px] flex items-center justify-center group-hover:bg-[#52d67f] transition-colors shadow-sm">
          <i class="fa-solid fa-tower-broadcast text-white text-lg" aria-hidden="true"></i>
        </div>
        <div>
          <div class="text-[17px] font-semibold text-neutral-900 dark:text-neutral-50">Kansas City Meshtastic</div>
        </div>
      </a>

      {/* Nav Links */}
      <div class="flex items-center gap-4">
        <ThemeToggle class="hidden lg:inline-flex" />
        <CampfireButton
          href="https://map.kansascitymesh.live"
          class="bg-[#67ea94] hover:bg-[#52d67f] text-white shadow-lg"
        >
          <i class="fa-solid fa-map w-4 h-4" aria-hidden="true"></i>
          MAP
          <i class="fa-solid fa-arrow-up-right-from-square w-3.5 h-3.5" aria-hidden="true"></i>
        </CampfireButton>
        {navLinks.map((link) => {
          const normalized = link.href === "/" ? "/" : link.href;
          const isActive = currentPath === normalized || currentPath.startsWith(`${normalized}/`);
          return (
            <a
              href={link.href}
              class={`text-[14px] font-semibold transition-colors ${isActive ? 'text-neutral-900 dark:text-neutral-50' : 'text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-50'}`}
            >
              {link.label.toUpperCase()}
            </a>
          );
        })}
      </div>
    </div>

    {/* Mobile Navigation */}
    <div class="lg:hidden flex items-center justify-between h-16">
      {/* Logo */}
      <a href="/" class="inline-flex items-center gap-2">
        <div class="w-10 h-10 bg-[#67ea94] rounded-[10px] flex items-center justify-center shadow-sm">
          <i class="fa-solid fa-tower-broadcast text-white text-lg" aria-hidden="true"></i>
        </div>
        <div class="text-[16px] font-semibold text-neutral-900 dark:text-neutral-50">KC Meshtastic</div>
      </a>

      {/* Theme Toggle + MAP Button + Hamburger */}
      <div class="flex items-center gap-2">
        <ThemeToggle />
        <CampfireButton
          href="https://map.kansascitymesh.live"
          size="small"
          class="bg-[#67ea94] hover:bg-[#52d67f] text-white"
        >
          MAP
          <i class="fa-solid fa-arrow-up-right-from-square w-3 h-3" aria-hidden="true"></i>
        </CampfireButton>
        <button
          id="navToggle"
          class="w-11 h-11 flex items-center justify-center text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-50 transition-colors"
          aria-label="Toggle navigation"
          aria-expanded="false"
          aria-controls="primaryNav"
        >
          <i class="fa-solid fa-bars w-6 h-6" aria-hidden="true"></i>
        </button>
      </div>
    </div>

    {/* Mobile Menu (Expanded) */}
    <div class="hidden lg:hidden border-t border-neutral-200 dark:border-neutral-800 py-4" id="primaryNav">
      <div class="flex flex-col space-y-1">
        {navLinks.map((link) => {
          const normalized = link.href === "/" ? "/" : link.href;
          const isActive = currentPath === normalized || currentPath.startsWith(`${normalized}/`);
          return (
            <a
              href={link.href}
              class={`px-4 py-3 text-[14px] font-semibold rounded-[10px] transition-colors min-h-[44px] flex items-center ${isActive ? 'text-neutral-900 dark:text-neutral-50 bg-neutral-100 dark:bg-neutral-800' : 'text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-50 hover:bg-neutral-100 dark:hover:bg-neutral-800'}`}
            >
              {link.label.toUpperCase()}
            </a>
          );
        })}
      </div>
    </div>
  </div>
</nav>

<script>
  // Mobile menu toggle
  document.addEventListener('DOMContentLoaded', function() {
    const navToggle = document.getElementById('navToggle');
    const primaryNav = document.getElementById('primaryNav');

    if (navToggle && primaryNav) {
      navToggle.addEventListener('click', function() {
        const isExpanded = navToggle.getAttribute('aria-expanded') === 'true';
        navToggle.setAttribute('aria-expanded', String(!isExpanded));
        primaryNav.classList.toggle('hidden');

        // Toggle icon
        const icon = navToggle.querySelector('i');
        if (icon) {
          icon.classList.toggle('fa-bars');
          icon.classList.toggle('fa-times');
        }
      });
    }
  });
</script>
