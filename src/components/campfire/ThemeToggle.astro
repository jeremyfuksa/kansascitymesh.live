---
const {
  class: className = '',
} = Astro.props;
---

<button
  type="button"
  class={`w-11 h-11 flex items-center justify-center rounded-[10px] text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-50 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors ${className}`}
  data-theme-toggle
  aria-label="Toggle color theme"
>
  <span class="sr-only">Toggle color theme</span>
  <i class="fa-solid fa-sun text-lg" data-icon="sun" aria-hidden="true"></i>
  <i class="fa-solid fa-moon text-lg hidden" data-icon="moon" aria-hidden="true"></i>
</button>

<script>
  const toggle = document.currentScript?.previousElementSibling;
  if (toggle && toggle.matches('[data-theme-toggle]')) {
    const storageKey = 'kcmesh-theme';
    const sunIcon = toggle.querySelector('[data-icon="sun"]');
    const moonIcon = toggle.querySelector('[data-icon="moon"]');

    const setIcons = (theme) => {
      if (!sunIcon || !moonIcon) return;
      if (theme === 'dark') {
        sunIcon.classList.add('hidden');
        moonIcon.classList.remove('hidden');
        toggle.setAttribute('aria-label', 'Switch to light mode');
      } else {
        sunIcon.classList.remove('hidden');
        moonIcon.classList.add('hidden');
        toggle.setAttribute('aria-label', 'Switch to dark mode');
      }
    };

    const getTheme = () => document.documentElement.classList.contains('dark') ? 'dark' : 'light';
    setIcons(getTheme());

    toggle.addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('dark');
      const theme = isDark ? 'dark' : 'light';
      localStorage.setItem(storageKey, theme);
      document.documentElement.dataset.theme = theme;
      setIcons(theme);
    });
  }
</script>
